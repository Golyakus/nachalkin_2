<?php

use yii\helpers\Html;
use yii\widgets\ListView;
use yii\widgets\ActiveForm;

/* @var $this yii\web\View */
/* @var $model app\models\Theme */
/* @var $subjectId */
/* @var $dataProvider yii\data\ActiveDataProvider */

if ($model->parent==null)
{
	$url = 'subject';
	$label = 'Предметы';
}
else
{
	$parentId = $model->parent;
	$url = ['view', 'subjectId' => $subjectId, 'id'=> $parentId];
	$label = $model->getParent()->title;
}

$this->title = $model->title;
$this->params['breadcrumbs'][] = ['label' => $label, 'url' => $url];
$this->params['breadcrumbs'][] = $this->title;
$themeId = $model->id;
?>
<div class="theme-view">

	<h2><?= \app\models\Subject::getSubjectName($subjectId) ?></h2> 
	<div>
    <h1><?= Html::encode($this->title) ?></h1>
        <?= Html::a('Редактировать тему', ['update', 'id' => $model->id, 'subjectId'=>$subjectId]) ?>
	</div>
    <p>Последнее изменение: <?= $model->updated_at ?>
    </p>
    <p><?= $model->description ?>
    </p>

    <h1>Все упражнения темы</h1>
        <?= Html::a('Добавить упражнение в тему', "/task/choosetype/$subjectId/$themeId") ?>
		
    <?= ListView::widget([
        'dataProvider' => $dataProvider,
        'itemOptions' => ['class' => 'item'],
        'itemView' => function ($model, $key, $index, $widget) use ($subjectId, $themeId) {
			$form = ActiveForm::begin();
			$model->taskType->traverse(['model'=>$model, 'form'=>$form, 'action'=>\app\utils\TaskType::RENDER_VIEW_ACTION]);
			ActiveForm::end();
            echo Html::a('Редактировать', \Yii::$app->urlManager->createUrl('task/newtask/'.$model->taskType->getType().'/'.$subjectId.'/'.$themeId));
        },
    ]) ?>
		
	

</div>
